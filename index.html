<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è£œåŠ©é‡‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã€å…¨éƒ¨å…¥ã‚Šç‰ˆã€‘</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #005bac; --bg: #f4f7f9; --green: #28a745; --red: #d9534f; --gray: #888; --line: #06c755; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background: var(--bg); padding: 10px; margin: 0; color: #333; line-height: 1.5; }
        
        /* æ“ä½œãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ï¼ˆå›ºå®šï¼‰ */
        .action-nav { position: sticky; top: 0; z-index: 100; background: var(--bg); padding: 10px 0; display: flex; gap: 8px; justify-content: center; max-width: 550px; margin: 0 auto; }
        .btn { flex: 1; border-radius: 8px; cursor: pointer; font-size: 0.75rem; font-weight: bold; padding: 12px 5px; border: none; transition: 0.2s; color: #fff; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .reset-btn { background-color: var(--red); }
        .save-btn { background-color: var(--primary); }
        .line-btn { background-color: var(--line); }
        .btn:active { transform: translateY(2px); opacity: 0.8; }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        #capture-area { max-width: 550px; margin: 0 auto; padding-bottom: 20px; }
        .container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; box-sizing: border-box; }
        h2 { font-size: 1.1rem; color: var(--primary); text-align: center; border-bottom: 2px solid var(--primary); padding-bottom: 8px; margin-top: 0; margin-bottom: 20px; }
        
        .section-frame { border: 1px solid #ddd; border-radius: 10px; padding: 15px; margin-bottom: 15px; background: #fff; }
        .result-frame { border: 2px solid #444; border-radius: 10px; padding: 15px; margin-bottom: 15px; background: #fff; }
        .profit-frame { border: 2px solid #ddd; border-radius: 10px; padding: 15px; background: #fdfdfd; }
        
        .form-group { margin-bottom: 12px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.85rem; }
        input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--primary); background: #f0f7ff; }
        
        .tax-label { font-size: 0.8rem; color: var(--gray); margin-top: 4px; text-align: right; }
        .res-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 0.95rem; font-weight: bold; }
        .val-text { font-size: 1.1rem; }
        
        .text-green { color: var(--green); }
        .text-red { color: var(--red); }
        .text-primary { color: var(--primary); }

        .type-selector { margin-bottom: 15px; padding: 12px; background: #fffbe6; border: 1px solid #ffe58f; border-radius: 8px; }
        select { width: 100%; padding: 10px; font-size: 1rem; border-radius: 8px; border: 1px solid #ccc; background: #fff; cursor: pointer; }

        .spacer { height: 30px; border-bottom: 1px dashed #ccc; margin-bottom: 30px; }
        .footer-note { font-size: 0.7rem; color: #aaa; text-align: center; margin-top: 10px; }

        @media (max-width: 480px) {
            .btn { font-size: 0.7rem; padding: 10px 2px; }
        }
    </style>
</head>
<body>

<div class="action-nav">
    <button class="btn reset-btn" onclick="resetAll()">ğŸ”„ å…¨æ¶ˆå»</button>
    <button class="btn save-btn" onclick="savePageImage()">ğŸ“¸ ç”»åƒä¿å­˜</button>
    <button class="btn line-btn" onclick="shareLine()">ğŸ’¬ LINE/å…±æœ‰</button>
</div>

<div id="capture-area">
    <div class="container">
        <h2>ITå°å…¥è£œåŠ©é‡‘ãƒ»åˆ©ç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
        <div class="section-frame">
            <div class="form-group">
                <label>â‘  ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è²©å£²é‡‘é¡ï¼ˆç¨åˆ¥ï¼‰</label>
                <input id="C4" type="number" pattern="\d*" placeholder="å…¥åŠ›" oninput="saveAndCalc()">
                <div class="tax-label">ç¨è¾¼ï¼š<span id="D4">0</span> å††</div>
            </div>
            <div class="form-group">
                <label>â‘¡ POSãƒãƒ¼ãƒ‰è²©å£²é‡‘é¡ï¼ˆç¨åˆ¥ï¼‰</label>
                <input id="C5" type="number" pattern="\d*" placeholder="å…¥åŠ›" oninput="saveAndCalc()">
                <div class="tax-label">ç¨è¾¼ï¼š<span id="D5">0</span> å††</div>
            </div>
            <div class="form-group">
                <label>â‘¢ PCè²©å£²é‡‘é¡ï¼ˆç¨åˆ¥ï¼‰</label>
                <input id="C6" type="number" pattern="\d*" placeholder="å…¥åŠ›" oninput="saveAndCalc()">
                <div class="tax-label">ç¨è¾¼ï¼š<span id="D6">0</span> å††</div>
            </div>
        </div>

        <div class="result-frame">
            <div class="form-group">
                <label>â‘¥ ALLå•†æåŸä¾¡è²»ç”¨ï¼ˆç¨åˆ¥ï¼‰</label>
                <input id="C30" type="number" pattern="\d*" placeholder="åŸä¾¡" oninput="saveAndCalc()">
                <div class="tax-label">ç¨è¾¼åŸä¾¡ï¼š<span id="D30">0</span> å††</div>
            </div>
            <div class="res-row"><span>â‘£ ç›®å®‰è£œåŠ©é‡‘ç¨è¾¼é¡</span><span class="val-text text-primary" id="G5">0 å††</span></div>
            <div class="res-row text-red"><span>â‘¤ å·®é¡ï¼ˆæ‰‹å‡ºã—é¡ï¼‰</span><span class="val-text" id="G6">0 å††</span></div>
        </div>

        <div class="profit-frame">
            <div class="res-row text-green"><span>â‘¦ è²©å£²åº—æ§˜æ‰•å‡ºç¨è¾¼é¡</span><span class="val-text" id="G30">0 å††</span></div>
            <div class="res-row text-red"><span>â‘§ è²©å£²åº—æ§˜ç¨è¾¼åˆ©ç›Š</span><span class="val-text" style="font-size:1.3rem;" id="G31">0 å††</span></div>
        </div>
    </div>

    <div class="spacer"></div>

    <div class="container">
        <h2>æŒç¶šåŒ–è£œåŠ©é‡‘ ç²¾å¯†è¨ˆç®—ãƒ„ãƒ¼ãƒ«</h2>
        <div class="type-selector">
            <label>ç”³è«‹æ ãƒ»åŠ ç‚¹ã®é¸æŠ</label>
            <select id="rateSelect" onchange="saveAndCalc()">
                <option value="0.6666666667">é€šå¸¸ç”³è«‹ (2/3)</option>
                <option value="0.75">èµ¤å­—ãƒ»è³ƒé‡‘å¼•ä¸Šã’åŠ ç‚¹ç­‰ (3/4)</option>
            </select>
        </div>
        <div class="section-frame">
            <label>â‘  ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆé–¢é€£è²»</label>
            <input type="number" id="webExp" pattern="\d*" placeholder="å…¥åŠ›" oninput="saveAndCalc()">
            <div class="tax-label" style="text-align:left;">äº¤ä»˜ç”³è«‹é¡: <strong class="text-primary" id="res3">0</strong> å††</div>
        </div>
        <div class="section-frame">
            <label>â‘¡ ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆé–¢é€£è²»ä»¥å¤–</label>
            <input type="number" id="otherExp" pattern="\d*" placeholder="å…¥åŠ›" oninput="saveAndCalc()">
            <div class="tax-label" style="text-align:left;">äº¤ä»˜ç”³è«‹é¡: <strong class="text-primary" id="res4">0</strong> å††</div>
        </div>
        <div class="result-frame">
            <div class="res-row text-green"><span>â‘¤ è£œåŠ©å¯¾è±¡çµŒè²»åˆè¨ˆ</span><span class="val-text" id="res5">0 å††</span></div>
            <div class="res-row text-primary"><span>â‘¥ è£œåŠ©é‡‘äº¤ä»˜ç”³è«‹é¡ åˆè¨ˆ</span><span class="val-text" id="res6">0 å††</span></div>
            <div class="res-row text-red"><span>â‘¦ æ‰‹å‡ºã—é¡</span><span class="val-text" id="res7">0 å††</span></div>
        </div>
        <div class="footer-note">â€»ITãƒ„ãƒ¼ãƒ«æ¤œç´¢ã¯ã€Œå—ç™ºæ³¨ã€ç­‰ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§å…¬å¼ã‚µã‚¤ãƒˆã‚’ã”ç¢ºèªãã ã•ã„</div>
    </div>
</div>

<script>
const fmt = (n) => Math.round(n).toLocaleString();
const fields = ["C4", "C5", "C6", "C30", "webExp", "otherExp", "rateSelect"];

// è‡ªå‹•ä¿å­˜ã¨è¨ˆç®—ã®å®Ÿè¡Œ
function saveAndCalc() {
    fields.forEach(id => {
        localStorage.setItem(id, document.getElementById(id).value);
    });
    calcTop();
    runCalcBottom();
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å¾©å…ƒ
window.onload = function() {
    fields.forEach(id => {
        const savedVal = localStorage.getItem(id);
        if (savedVal !== null) document.getElementById(id).value = savedVal;
    });
    calcTop();
    runCalcBottom();
};

// å…¨æ¶ˆå»
function resetAll() {
    if(!confirm("å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã¨ä¿å­˜ã•ã‚ŒãŸè¨˜éŒ²ã‚’ã™ã¹ã¦æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ")) return;
    fields.forEach(id => {
        localStorage.removeItem(id);
        document.getElementById(id).value = (id === "rateSelect") ? "0.6666666667" : "";
    });
    calcTop();
    runCalcBottom();
}

// ç”»åƒä¿å­˜
function savePageImage() {
    const btn = document.querySelector('.save-btn');
    const originalText = btn.innerText;
    btn.innerText = "ä½œæˆä¸­...";
    
    html2canvas(document.querySelector("#capture-area"), {
        scale: 2,
        useCORS: true,
        backgroundColor: "#f4f7f9"
    }).then(canvas => {
        const link = document.createElement('a');
        link.download = `è£œåŠ©é‡‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³_${new Date().getTime()}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
        btn.innerText = originalText;
    }).catch(e => {
        alert("ç”»åƒä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        btn.innerText = originalText;
    });
}

// LINE/ãƒãƒ£ãƒƒãƒˆå…±æœ‰ï¼ˆã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ä»˜ãï¼‰
function shareLine() {
    const itSub = document.getElementById("G5").innerText;
    const itDiff = document.getElementById("G6").innerText;
    const itProfit = document.getElementById("G31").innerText;
    const jizokuSub = document.getElementById("res6").innerText;
    const jizokuDiff = document.getElementById("res7").innerText;

    const text = `ã€è£œåŠ©é‡‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœã€‘\n\n` +
                 `â– ITå°å…¥è£œåŠ©é‡‘\n` +
                 `ãƒ»ç›®å®‰è£œåŠ©é‡‘ï¼š${itSub}\n` +
                 `ãƒ»å®Ÿè³ªæ‰‹å‡ºã—ï¼š${itDiff}\n` +
                 `ãƒ»è²©å£²åº—åˆ©ç›Šï¼š${itProfit}\n\n` +
                 `â– æŒç¶šåŒ–è£œåŠ©é‡‘\n` +
                 `ãƒ»ç”³è«‹é¡åˆè¨ˆï¼š${jizokuSub}\n` +
                 `ãƒ»å®Ÿè³ªæ‰‹å‡ºã—ï¼š${jizokuDiff}\n\n` +
                 `â€»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‹ã‚‰å…±æœ‰`;

    // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã‚³ãƒ”ãƒ¼ï¼ˆLINE WORKSç­‰ç”¨ï¼‰
    navigator.clipboard.writeText(text).then(() => {
        // é€šå¸¸ã®LINEèµ·å‹•
        const lineUrl = `https://line.me/R/msg/text/?${encodeURIComponent(text)}`;
        window.open(lineUrl, '_blank');
        
        // ã‚¹ãƒãƒ›å‘ã‘ã«é€šçŸ¥
        alert("çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\nLINE WORKSç­‰ã«ã¯ãã®ã¾ã¾ã€Œè²¼ã‚Šä»˜ã‘ã€ã¦å…±æœ‰ã§ãã¾ã™ã€‚");
    });
}

// --- è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯æœ¬ä½“ ---
function calcTop(){
    const C4=Number(document.getElementById("C4").value)||0;
    const C5=Number(document.getElementById("C5").value)||0;
    const C6=Number(document.getElementById("C6").value)||0;
    const C30=Number(document.getElementById("C30").value)||0;
    const D4=C4*1.1, D5=C5*1.1, D6=C6*1.1, D30=C30*1.1;

    let G5_calc=(C4>=666667)?C4-666667:C4;
    let I5=(G5_calc>=666667)?G5_calc/3*2:G5_calc*0.75;
    let I6=(C4-G5_calc)*0.75;
    let I7=Math.min(I5+I6,3500000);
    let optBonus=(C5>=400000)?200000:C5*0.5;
    let svcBonus=(C6>=200000)?100000:C6*0.5;
    const subsidy=I7+optBonus+svcBonus;
    const diff=(D4+D5+D6)-subsidy;
    const payout=(D4+D5+D6)-D30;
    const profit=payout-diff;

    document.getElementById("D4").textContent=fmt(D4);
    document.getElementById("D5").textContent=fmt(D5);
    document.getElementById("D6").textContent=fmt(D6);
    document.getElementById("D30").textContent=fmt(D30);
    document.getElementById("G5").textContent=fmt(subsidy)+" å††";
    document.getElementById("G6").textContent=fmt(diff)+" å††";
    document.getElementById("G30").textContent=fmt(payout)+" å††";
    document.getElementById("G31").textContent=fmt(profit)+" å††";
}

function runCalcBottom() {
    const webTotal = parseFloat(document.getElementById('webExp').value) || 0; 
    const otherTotal = parseFloat(document.getElementById('otherExp').value) || 0; 
    const rate = parseFloat(document.getElementById('rateSelect').value);
    const res4 = Math.floor(otherTotal * rate);
    let val3_1 = Math.min(otherTotal * 0.25, 500000);
    const res3 = Math.floor(Math.min(val3_1, webTotal * rate, res4 / 3));
    const res5 = webTotal + otherTotal;
    const res6 = Math.min(res3 + res4, 2000000);
    const res7 = res5 - res6;
    document.getElementById('res3').innerText = fmt(res3);
    document.getElementById('res4').innerText = fmt(res4);
    document.getElementById('res5').innerText = fmt(res5) + " å††";
    document.getElementById('res6').innerText = fmt(res6) + " å††";
    document.getElementById('res7').innerText = fmt(res7) + " å††";
}
</script>
</body>
</html>
